"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _store=_interopRequireDefault(require("./store"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var aHu=function(e){_init(e)},_init=function(o){_store.default.routeToVm||(_store.default.routeToVm={});var r=o.onLoad;o.onLoad=function(e){var t=this;_isObr(_store.default)?(o.data.storeView=Object.assign({},_store.default._noObView),o.data.storeModel=Object.assign({},_store.default._noObModel)):(_store.default._noObView=JSON.parse(JSON.stringify(_store.default.storeView)),_store.default._noObModel=JSON.parse(JSON.stringify(_store.default.storeModel)),o.data.storeView=JSON.parse(JSON.stringify(_store.default._noObView)),o.data.storeModel=JSON.parse(JSON.stringify(_store.default._noObModel)),observer(_store.default.storeView,"storeView"),observer(_store.default.storeModel,"storeModel")),o.data._remainChangeView=Object.create(null),t.store=_store.default,_store.default.routeToVm[t.route]||(_store.default.routeToVm[t.route]=[]),_store.default.routeToVm[t.route].push(t),t.setData(o.data),r&&r.call(this,e)};var n=o.onShow;o.onShow=function(e){var t=this;if(Object.keys(t.data._remainChangeView).length){var o=JSON.parse(JSON.stringify(t.data._remainChangeView));t.setData(o),t.data._remainChangeView=Object.create(null)}n&&user_onShowcall(this,e)},Page(o)},_isObr=function(e){return e.hasOwnProperty("_noObView")},observer=function(e,t){_walk(e,t)},_walk=function t(o,r){Object.keys(o).forEach(function(e){_defineReactive(o,e,r,o[e]),"[object Array]"===Object.prototype.toString.call(o[e])?_reWritePrototypeFn(o[e],o,e):"object"===_typeof(o[e])&&t(o[e],r+"."+e)})},_walkChild=function(e,t,o,r){"[object Array]"===Object.prototype.toString.call(e)?_reWritePrototypeFn(e,o,r):"object"===_typeof(e)&&_walk(e,t)},_reWritePrototypeFn=function(a,i,s){var u=a.__proto__;u&&(a.__proto__={},a.__proto__.__proto__=u,["push","splice","reverse","pop","shift","sort"].forEach(function(n){a.__proto__[n]=function(){for(var e=a.slice(),t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];u[n].apply(e,o),i[s]=e}}))},_defineReactive=function(t,f,_,n){Object.defineProperty(t,f,{get:function(){return n},set:function(a){var i=getCurrentPages(),s=i[i.length-1],e=JSON.parse(JSON.stringify(n));if(JSON.stringify(n)!==JSON.stringify(a)){n=a;var u=_.startsWith("storeView"),o=_store.default._noObView,r=_store.default._noObModel;_.split(".").forEach(function(e,t){0<t&&(u?o=o[e]:r=r[e])}),u?o[f]=JSON.parse(JSON.stringify(a)):r[f]=JSON.parse(JSON.stringify(a)),_walkChild(n,_,t,f),Object.keys(_store.default.routeToVm).forEach(function(r,e){var n="".concat(_,".").concat(f);_store.default.routeToVm[r].forEach(function(t,e){if(i.some(function(e){return e===t}))if(u)t===s?t.setData(_defineProperty({},n,JSON.parse(JSON.stringify(a)))):t.data._remainChangeView[n]=JSON.parse(JSON.stringify(a));else{var o=t.data;_.split(".").forEach(function(e){o=o[e]}),o[f]=JSON.parse(JSON.stringify(a))}else _store.default.routeToVm[r].splice(e,1)})}),_log("".concat(_,".").concat(f),e,a)}}})},handError=function(){},initPlugin=function(){},_on=function(e,t){aHu.sub||(aHu.sub={}),aHu.hasOwnProperty(e)?aHu.sub[e].push(t):aHu.sub[e]=[t]},_emit=function(e,t){aHu.sub[e]&&aHu.sub[e].forEach(function(e){e(t)})},_log=function(e,t,o){console.log("aHu日志：修改属性".concat(e,"，由").concat(JSON.stringify(t),"改为").concat(JSON.stringify(o)))};aHu.on=_on,aHu.emit=_emit;var _default=aHu;exports.default=_default;